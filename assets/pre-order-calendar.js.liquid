"use strict";function ownKeys(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var POCListener=function(){function e(t){_classCallCheck(this,e),this.settings=_objectSpread(_objectSpread({},t),{},{el:"poc-confirmation",alertEl:"poc-alert",addButton:"pre-order-add",confirmationOpenClass:"js-confirmation-open"}),this.init()}return _createClass(e,[{key:"init",value:function(){var n=this;this.checkCartHasPreOrder(),this.appendConfirmation(),$(document).on("cart.requestComplete",function(t,e){n.checkCartHasPreOrder(),n.cartHasPre&&1<CartJS.cart.items.length&&n.removeAdditionalProducts(function(){n.cartHadPre=!0}),n.cartHadPre?(n.cartHadPre=!1,n.showAlert()):n.hideAlert()}),$(".".concat(this.settings.addButton)).click(function(t){t.preventDefault();var e=!0;CartJS.cart.items.forEach(function(t){e=t.product_id==n.settings.pId&&e}),n.quantity=$(t.target).closest("form").find(".quantity-field__field").val(),e?n.addPreOrderToCart():n.showConfirmation()})}},{key:"checkCartHasPreOrder",value:function(){var e=this;this.cartHasPre=!1,CartJS.cart.items.forEach(function(t){e.cartHasPre=t.product_id==e.settings.pId||e.cartHasPre})}},{key:"showConfirmation",value:function(){$("body").addClass(this.settings.confirmationOpenClass),$(".".concat(this.settings.el)).fadeIn(Theme.eta),Theme.closeQuick()}},{key:"hideConfirmation",value:function(){$("body").removeClass(this.settings.confirmationOpenClass),$(".".concat(this.settings.el)).fadeOut(Theme.eta)}},{key:"showAlert",value:function(){$('<div class="side-cart__alert '.concat(this.settings.alertEl,'">').concat(this.settings.ribbon,"</div>")).prependTo(".side-cart__copy").hide().fadeIn(Theme.eta)}},{key:"hideAlert",value:function(){var t=this;$(".".concat(this.settings.alertEl)).fadeOut(Theme.eta,function(){$(".".concat(t.settings.alertEl)).remove()})}},{key:"appendConfirmation",value:function(){var e=this;$("body").append('\n    <div class="'.concat(this.settings.el,'">\n      <div class="').concat(this.settings.el,'__inner">\n        <div class="').concat(this.settings.el,'__copy">\n          ').concat(this.settings.confirmation,'\n        </div>\n        <div class="').concat(this.settings.el,'__footer">\n          <a class="').concat(this.settings.el,'__yes b">Yes</a>\n          <a class="').concat(this.settings.el,'__no b">No</a>\n        </div>\n      </div>\n    </div>\n    ')),$(".".concat(this.settings.el,"__no")).click(function(t){t.preventDefault(),e.hideConfirmation()}),$(".".concat(this.settings.el,"__yes")).click(function(t){t.preventDefault(),e.removeAdditionalProducts(),e.addPreOrderToCart(),e.hideConfirmation()})}},{key:"addPreOrderToCart",value:function(){CartJS.addItem(this.settings.vId,this.quantity)}},{key:"removeAdditionalProducts",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},n={};CartJS.cart.items.forEach(function(t){t.product_id!=e.settings.pId&&(n[t.key]=0)}),$.ajax({url:"/cart/update.js",data:{updates:n},dataType:"json",success:function(){CartJS.getCart(),t()}})}}]),e}();$(document).ready(function(){window.pocListener=new POCListener(window.pocSettings)});