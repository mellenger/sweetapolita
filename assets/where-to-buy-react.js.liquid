"use strict";function asyncGeneratorStep(e,t,n,r,a,o,c){try{var s=e[o](c),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function _asyncToGenerator(s){return function(){var e=this,c=arguments;return new Promise(function(t,n){var r=s.apply(e,c);function a(e){asyncGeneratorStep(r,t,n,a,o,"next",e)}function o(e){asyncGeneratorStep(r,t,n,a,o,"throw",e)}a(void 0)})}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],c=!0,s=!1;try{for(n=n.call(e);!(c=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);c=!0);}catch(e){s=!0,a=e}finally{try{c||null==n.return||n.return()}finally{if(s)throw a}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var ASSETS=window.whereToBuyAssets,VANCOUVER={lat:49.28323201694063,lng:-123.12089349382718},ENDPOINT="https://sweetapolita-where-to-buy.herokuapp.com",PhysicalStores=function(e){var r=e.onStoreSelected,t=e.physicalStores,a=e.selectedStore,o=React.useRef([]);if(React.useEffect(function(){null!==a&&o.current[a].scrollIntoView({behavior:"smooth",block:"nearest"})},[a]),t&&t.length){var c="where-to-buy__physical-store";return React.createElement("ul",{className:"where-to-buy__map-physical-stores"},t.map(function(e,t){var n=[c,a===t&&"".concat(c,"--selected")].filter(function(e){return e}).join(" ");return React.createElement("li",{key:t,className:n,onClick:function(){return r(t)},ref:function(e){return o.current[t]=e}},React.createElement("h4",null,e.name),React.createElement("p",{className:"where-to-buy__physical-store-address"},e.address),React.createElement("p",{className:"where-to-buy__physical-store-distance"},(e.distance/1e3).toFixed(1),"km"))}))}return React.createElement("div",null,React.createElement("h4",null,"No stores found in the selected country."))},OnlineStores=function(){return React.createElement("div",{className:"where-to-buy__map-right-container"},React.createElement("div",{className:"where-to-buy__map-title-row"},React.createElement("h4",null,"Online shops")),React.createElement("ul",{className:"where-to-buy__map-online-stores"},React.createElement("li",{className:"where-to-buy__online-store"},React.createElement("h4",null,"Sweetapolita"),React.createElement("a",{href:"#"},"sweetapolita.com"))))},RANGE_OPTIONS=[1e4,25e3,5e4,1e5],RangeSelector=function(e){var t=e.value,n=e.onChange;return React.createElement("div",{className:"where-to-buy__map-title-row"},React.createElement("h4",null,"Nearest Retail Stores"),React.createElement("select",{name:"",onChange:function(e){return n(e.target.value)},value:t},RANGE_OPTIONS.map(function(e,t){return React.createElement("option",{value:e,key:t},e/1e3," km")})))},MapContainer=function(e){function a(e){return new google.maps.Marker({position:e,map:i.current,icon:"user"===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"user")?ASSETS.userMarker:ASSETS.storeMarker})}function n(e){g(e),f.map(function(e){return e.close()});var t=m[e];f[e].open({anchor:t,mapRef:i,shouldFocus:!0}),i.current.panTo({lat:t.position.lat(),lng:t.position.lng()})}var t=e.isMapActive,o=e.physicalStores,c=e.userLocation,r=e.range,s=e.onRangeChange,l=React.useRef(),i=React.useRef(),u=_slicedToArray(React.useState(null),2),y=u[0],d=u[1],e=_slicedToArray(React.useState([]),2),m=e[0],p=e[1],u=_slicedToArray(React.useState([]),2),f=u[0],h=u[1],e=_slicedToArray(React.useState(null),2),u=e[0],g=e[1];React.useEffect(function(){i.current=new google.maps.Map(l.current,{zoom:12,center:VANCOUVER,styles:MAP_STYLES,disableDefaultUI:!0,zoomControl:!0,controlSize:30})},[]),React.useEffect(function(){c&&(i.current.panTo(c.location),y?y.setPosition(c.location):d(a(c.location)))},[c]),React.useEffect(function(){var n,r,e;o&&(g(null),m.map(function(e){return e.setMap(null)}),o.length&&((n=new google.maps.LatLngBounds).extend(c.location),r=[],e=o.map(function(e){n.extend(e.location);var t=new URLSearchParams({query:"".concat(e.name," ").concat(e.address," ").concat(null!==(t=e.country)&&void 0!==t?t:"")});return r.push(new google.maps.InfoWindow({content:'\n                <div class="where-to-buy__physical-store">\n                  <h4>'.concat(e.name,'</h4>\n                  <a\n                    class="where-to-buy__physical-store-address"\n                    target="_blank"\n                    href="https://www.google.com/maps/search/?api=1&').concat(t.toString(),'"\n                  >\n                      ').concat(e.address,'\n                  </a>\n                  <p class="where-to-buy__physical-store-distance">\n                    ').concat((e.distance/1e3).toFixed(1),"km\n                  </p>\n                </div>")})),a(e.location,"store")}),h(r),p(e),i.current.fitBounds(n)))},[o]),React.useEffect(function(){m&&m.length&&m.map(function(e,t){e.addListener("click",function(){n(t)})})},[m,f]);e="where-to-buy__map-container",e=[e,t&&"".concat(e,"--active")].filter(function(e){return e}).join(" ");return React.createElement("div",{className:e},React.createElement("div",{className:"where-to-buy__map-info"},React.createElement("p",null,"Here are the closest stores and online shops that ships to your location.")),React.createElement("div",{className:"where-to-buy__map-left-container"},React.createElement(RangeSelector,{value:r,onChange:s}),React.createElement("div",{className:"where-to-buy__map-content"},React.createElement(PhysicalStores,{physicalStores:o,onStoreSelected:n,selectedStore:u}),React.createElement("div",{id:"where-to-buy__map",ref:l}))),React.createElement(OnlineStores,null))},AddressContainer=function(e){function t(){var e,t=a.current.getPlace();t.geometry?(e=getCountryFromAddressComponents(t.address_components),e={location:{lat:t.geometry.location.lat(),lng:t.geometry.location.lng()},country:e},l(!1),r(e)):console.warn("User did not select a prediction")}var n=e.isMapActive,r=e.onPlaceChanged,a=React.useRef(),o=React.useRef(),c=React.useRef(),e=_slicedToArray(React.useState(!0),2),s=e[0],l=e[1];React.useEffect(function(){a.current=new google.maps.places.Autocomplete(o.current,{fields:["geometry","name","address_component"],strictBounds:!1,types:[]}),a.current.addListener("place_changed",t),c.current=new google.maps.Geocoder},[]),React.useEffect(function(){s&&(navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var n={lat:e.coords.latitude,lng:e.coords.longitude};c.current.geocode({location:n}).then(function(e){e&&e.results&&e.results.length||r({location:n,country:void 0});var t=e.results[0];t.address_components?(e=getCountryFromAddressComponents(t.address_components),o.current.value=t.formatted_address,r({location:n,country:e})):r({location:n,country:void 0})})},function(){l(!1),console.error("Use of geolocation not allowed")}):console.warn("Navigator doesn't have geolocation"))},[s]);e="where-to-buy__location-button",e=[e,s&&"".concat(e,"--active")].filter(function(e){return e}).join(" ");return React.createElement("div",{className:"where-to-buy__address-container"},!n&&React.createElement("p",{className:"where-to-buy__autocomplete-cta"},"Start typing your address to find the nearest stores."),React.createElement("div",{className:"where-to-buy__autocomplete-container"},React.createElement("img",{className:"where-to-buy__pin",src:ASSETS.locationPin}),React.createElement("input",{id:"where-to-buy__autocomplete",placeholder:"Enter an address",type:"text",ref:o}),React.createElement("button",{id:"where-to-buy__location-button",className:e,onClick:function(){return l(function(e){return!e})}})))},WhereToBuy=function(){var e=_slicedToArray(React.useState(!1),2),t=e[0],n=e[1],r=_slicedToArray(React.useState(null),2),a=r[0],o=r[1],e=_slicedToArray(React.useState([]),2),r=e[0],c=e[1],e=_slicedToArray(React.useState([]),2),e=(e[0],e[1],_slicedToArray(React.useState(RANGE_OPTIONS[0]),2)),s=e[0],l=e[1];return React.useEffect(function(){var e=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(ENDPOINT,"/coords"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({coordinates:t.location,country:t.country,range:parseInt(s)})});case 2:return n=e.sent,e.next=5,n.json();case 5:n=e.sent,(n=n.body)&&n.length?function(e){var n=[];e.map(function(e){var t={lat:e.location.coordinates[1],lng:e.location.coordinates[0]};"WTB-Physical"===e.type&&n.push({name:e.name,address:e.address,distance:e.distance,location:t,country:e.country})}),c(n)}(n):console.error("no data returned");case 8:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}();a&&(a.country.match(/ca/i)||a.country.match(/us/i)?e(a):c([]))},[a,s]),React.createElement("div",{className:"where-to-buy"},React.createElement(AddressContainer,{onPlaceChanged:function(e){o(e),n(!0)},isMapActive:t}),React.createElement(MapContainer,{isMapActive:t,userLocation:a,physicalStores:r,range:s,onRangeChange:function(e){return l(e)}}))},createApp=function e(){var t;"undefined"!=typeof google?(t=document.querySelector("#where-to-buy__react"),ReactDOM.render(React.createElement(WhereToBuy),t)):(console.log("Waiting for google to create app"),window.setTimeout(e,500))};createApp();var MAP_STYLES=[{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{stylers:[{hue:"#00aaff"},{saturation:-100},{gamma:2.15},{lightness:12}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{visibility:"on"},{lightness:24}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:57}]}],getCountryFromAddressComponents=function(e){e=e.filter(function(e){return e.types.includes("country")});if(e)return e[0].short_name};